<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <meta name="description" content="IEC60034 Temperature and Resistance Calculator">
    <base href="/iec60034-calculator/">
    <title>IEC60034 Calculator</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="./icon-512.png">
    
    <script crossorigin src="./assets/react.production.min.js"></script>
    <script crossorigin src="./assets/react-dom.production.min.js"></script>
    <script src="./assets/babel.min.js"></script>
    <script src="./assets/tailwind.css"></script>
    
    <style>
            .formula-title {
                font-weight: bold;
                font-size: 0.75rem;
                margin-bottom: 10px;
                color: #111827;
                text-align: left;
            }
            
            .formula-legend {
                margin-top: 10px;
                font-size: 0.75rem;
                color: #4b5563;
                line-height: 1.5;
                width: 100%;
                border-top: 1px dashed #d1d5db;
                padding-top: 10px;
            }
            
            .legend-item {
                display: block;
                margin-bottom: 2px;
            }
            
            .legend-item strong {
                color: #1f2937;
            }    
                    
            .formula-card-content {
                display: flex;
                flex-direction: column;
                align-items: left;
                justify-content: left;
                padding: 15px;
                background: #f9fafb;
                border-radius: 8px;
                margin: 10px 0;
            }
            
            .formula-display {
                font-family: "Times New Roman", Times, serif;
                font-style: italic;
                font-size: 0.9rem;
                display: flex;
                align-items: center;
                gap: 6px;
                color: #1f2937;
                flex-wrap: wrap;
            }
            
            .fraction-container {
                display: inline-flex;
                flex-direction: column;
                align-items: center;
                vertical-align: middle;
            }
            
            .fraction-numerator {
                padding: 0 5px 1px 5px;
            }
            
            .fraction-denominator {
                border-top: 1.5px solid #374151;
                padding: 1px 5px 0 5px;
                width: 100%;
                text-align: center;
            }
            
            .sub {
                font-style: normal;
                font-size: 0.7em;
                vertical-align: sub;
                line-height: 0;
            }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const Calculator = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="16" y1="14" x2="16" y2="14.01"/>
                <line x1="12" y1="14" x2="12" y2="14.01"/>
                <line x1="8" y1="14" x2="8" y2="14.01"/>
                <line x1="16" y1="18" x2="16" y2="18.01"/>
                <line x1="12" y1="18" x2="12" y2="18.01"/>
                <line x1="8" y1="18" x2="8" y2="18.01"/>
            </svg>
        );

        const Thermometer = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>
            </svg>
        );

        const TrendingUp = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
                <polyline points="16 7 22 7 22 13"/>
            </svg>
        );

        const Settings = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
        );

        const Zap = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
        );

        function TempCalculator() {
            const [currentPage, setCurrentPage] = useState(0);
            const [touchStart, setTouchStart] = useState(null);
            const [touchEnd, setTouchEnd] = useState(null);

            // Page 1 states
            const [R1, setR1] = useState('');
            const [R2, setR2] = useState('');
            const [T1, setT1] = useState('');
            const [T2, setT2] = useState('');
            const [material, setMaterial] = useState('copper');
            const [calculatedField, setCalculatedField] = useState(null);

            // Page 2 states
            const [res1, setRes1] = useState('');
            const [res2, setRes2] = useState('');
            const [res3, setRes3] = useState('');
            const [average, setAverage] = useState(null);
            const [upperLimit, setUpperLimit] = useState(null);
            const [lowerLimit, setLowerLimit] = useState(null);

            // Page 3 states
            const [speed, setSpeed] = useState('');
            const [frequency, setFrequency] = useState('');
            const [poles, setPoles] = useState('');
            const [calculatedField3, setCalculatedField3] = useState(null);
            const [speedWarning, setSpeedWarning] = useState(null);
            const [frequencyWarning, setFrequencyWarning] = useState(null);

            // Page 4 states
            const [realPower, setRealPower] = useState('');
            const [apparentPower, setApparentPower] = useState('');
            const [powerFactor, setPowerFactor] = useState('');
            const [voltage, setVoltage] = useState('');
            const [current, setCurrent] = useState('');
            const [calculatedField4, setCalculatedField4] = useState([]);
            const [reactivePower, setReactivePower] = useState(null);

            const materials = {
                copper: { name: 'Copper', k: 235 },
                aluminum: { name: 'Aluminum', k: 225 }
            };

            const minSwipeDistance = 50;

            const onTouchStart = (e) => {
                setTouchEnd(null);
                setTouchStart(e.targetTouches[0].clientX);
            };

            const onTouchMove = (e) => {
                setTouchEnd(e.targetTouches[0].clientX);
            };

            const onTouchEnd = () => {
                if (!touchStart || !touchEnd) return;
                
                const distance = touchStart - touchEnd;
                const isLeftSwipe = distance > minSwipeDistance;
                const isRightSwipe = distance < -minSwipeDistance;
                
                if (isLeftSwipe && currentPage < 3) {
                    setCurrentPage(currentPage + 1);
                }
                if (isRightSwipe && currentPage > 0) {
                    setCurrentPage(currentPage - 1);
                }
            };

            const calculateMissing = () => {
                const r1 = R1 === '' ? null : parseFloat(R1);
                const r2 = R2 === '' ? null : parseFloat(R2);
                const t1 = T1 === '' ? null : parseFloat(T1);
                const t2 = T2 === '' ? null : parseFloat(T2);
                const k = materials[material].k;

                const filled = [r1, r2, t1, t2].filter(v => v !== null);
                const empty = [r1, r2, t1, t2].filter(v => v === null);

                if (filled.length !== 3 || empty.length !== 1) {
                    alert('Please enter exactly 3 values and leave 1 empty to calculate');
                    return;
                }

                if (filled.some(v => isNaN(v))) {
                    alert('Please enter valid numbers');
                    return;
                }

                try {
                    if (r1 === null) {
                        if (r2 <= 0) throw new Error('R2 must be positive');
                        const result = r2 * (k + t1) / (k + t2);
                        if (result <= 0 || !isFinite(result)) throw new Error('Invalid calculation result');
                        setR1(result.toFixed(4));
                        setCalculatedField('R1');
                    } 
                    else if (r2 === null) {
                        if (r1 <= 0) throw new Error('R1 must be positive');
                        const result = r1 * (k + t2) / (k + t1);
                        if (result <= 0 || !isFinite(result)) throw new Error('Invalid calculation result');
                        setR2(result.toFixed(4));
                        setCalculatedField('R2');
                    } 
                    else if (t1 === null) {
                        if (r1 <= 0 || r2 <= 0) throw new Error('Resistances must be positive');
                        const result = (r1 * (k + t2) / r2) - k;
                        if (!isFinite(result)) throw new Error('Invalid calculation result');
                        setT1(result.toFixed(2));
                        setCalculatedField('T1');
                    } 
                    else if (t2 === null) {
                        if (r1 <= 0 || r2 <= 0) throw new Error('Resistances must be positive');
                        const result = (r2 / r1) * (k + t1) - k;
                        if (!isFinite(result)) throw new Error('Invalid calculation result');
                        setT2(result.toFixed(2));
                        setCalculatedField('T2');
                    }
                } catch (error) {
                    alert(error.message || 'Calculation error - please check your values');
                }
            };

            const calculateAverage = () => {
                const r1 = parseFloat(res1);
                const r2 = parseFloat(res2);
                const r3 = parseFloat(res3);

                if (isNaN(r1) || isNaN(r2) || isNaN(r3)) {
                    alert('Please enter valid numbers for all three resistances');
                    return;
                }

                const avg = (r1 + r2 + r3) / 3;
                const upper = avg * 1.01;
                const lower = avg * 0.99;

                setAverage(avg);
                setUpperLimit(upper);
                setLowerLimit(lower);
            };

            const reset = () => {
                setR1('');
                setR2('');
                setT1('');
                setT2('');
                setCalculatedField(null);
            };

            const resetPage2 = () => {
                setRes1('');
                setRes2('');
                setRes3('');
                setAverage(null);
                setUpperLimit(null);
                setLowerLimit(null);
            };

            const calculateSpeed = () => {
                const n = speed === '' ? null : parseFloat(speed);
                const f = frequency === '' ? null : parseFloat(frequency);
                const p = poles === '' ? null : parseFloat(poles);

                setSpeedWarning(null);
                setFrequencyWarning(null);

                const filled = [n, f, p].filter(v => v !== null);
                const empty = [n, f, p].filter(v => v === null);

                if (filled.length !== 2 || empty.length !== 1) {
                    alert('Please enter exactly 2 values and leave 1 empty to calculate');
                    return;
                }

                if (filled.some(v => isNaN(v) || v <= 0)) {
                    alert('Please enter valid positive numbers');
                    return;
                }

                try {
                    if (n === null) {
                        if (!Number.isInteger(p) || p % 2 !== 0) {
                            alert('Poles must be an integer and a factor of 2');
                            return;
                        }
                        const result = (120 * f) / p;
                        setSpeed(Math.round(result * 100) / 100);
                        setCalculatedField3('speed');
                    } 
                    else if (f === null) {
                        if (!Number.isInteger(p) || p % 2 !== 0) {
                            alert('Poles must be an integer and a factor of 2');
                            return;
                        }
                        const result = (n * p) / 120;
                        setFrequency(Math.round(result * 100) / 100);
                        setCalculatedField3('frequency');
                    } 
                    else if (p === null) {
                        const result = (120 * f) / n;
                        
                        let roundedPoles = Math.round(result);
                        
                        if (roundedPoles % 2 !== 0) {
                            const lowerEven = roundedPoles - 1;
                            const upperEven = roundedPoles + 1;
                            roundedPoles = (Math.abs(result - lowerEven) < Math.abs(result - upperEven)) ? lowerEven : upperEven;
                        }
                        
                        setPoles(roundedPoles);
                        setCalculatedField3('poles');
                        
                        const calculatedFrequency = (n * roundedPoles) / 120;
                        const frequencyDiff = Math.abs(calculatedFrequency - f);
                        if (frequencyDiff > 0.5) {
                            setFrequencyWarning(
                                `Warning: With ${roundedPoles} poles and ${n} RPM, the frequency would be ${calculatedFrequency.toFixed(2)} Hz (differs by ${frequencyDiff.toFixed(2)} Hz from input ${f} Hz). This may not represent a realistic machine design.`
                            );
                        }
                        
                        const calculatedSpeed = (120 * f) / roundedPoles;
                        const speedDiff = Math.abs(calculatedSpeed - n);
                        if (speedDiff > 50) {
                            setSpeedWarning(
                                `Warning: With ${roundedPoles} poles and ${f} Hz, the speed would be ${calculatedSpeed.toFixed(2)} RPM (differs by ${speedDiff.toFixed(2)} RPM from input ${n} RPM). This may not represent a realistic machine design.`
                            );
                        }
                    }
                } catch (error) {
                    alert('Calculation error - please check your values');
                }
            };

            const resetPage3 = () => {
                setSpeed('');
                setFrequency('');
                setPoles('');
                setCalculatedField3(null);
                setSpeedWarning(null);
                setFrequencyWarning(null);
            };

            const calculatePower = () => {
                const P = realPower === '' ? null : parseFloat(realPower);
                const S = apparentPower === '' ? null : parseFloat(apparentPower);
                const pf = powerFactor === '' ? null : parseFloat(powerFactor);
                const V = voltage === '' ? null : parseFloat(voltage);
                const I = current === '' ? null : parseFloat(current);

                // Clear previous calculated fields - now using array for multiple fields
                setCalculatedField4([]);

                // Validate inputs
                if (P !== null && (isNaN(P) || P <= 0)) {
                    alert('Real Power must be a positive number');
                    return;
                }
                if (S !== null && (isNaN(S) || S <= 0)) {
                    alert('Apparent Power must be a positive number');
                    return;
                }
                if (pf !== null && (isNaN(pf) || pf <= 0 || pf > 1)) {
                    alert('Power Factor must be between 0 and 1');
                    return;
                }
                if (V !== null && (isNaN(V) || V <= 0)) {
                    alert('Voltage must be a positive number');
                    return;
                }
                if (I !== null && (isNaN(I) || I <= 0)) {
                    alert('Current must be a positive number');
                    return;
                }

                try {
                    // Case 1: V and I both given
                    if (V !== null && I !== null) {
                        // Calculate S from V and I: S = ‚àö3 √ó V √ó I / 1000
                        const calcS = Math.sqrt(3) * V * I / 1000;
                        setApparentPower(calcS.toFixed(4));
                        const calculated = ['apparentPower'];

                        // If we have pf, calculate P
                        if (pf !== null) {
                            const calcP = calcS * pf;
                            setRealPower(calcP.toFixed(4));
                            calculated.push('realPower');
                            
                            const sinTheta = Math.sqrt(1 - pf * pf);
                            const Q = calcS * sinTheta;
                            setReactivePower(Q.toFixed(4));
                        }
                        // If we have P, calculate pf
                        else if (P !== null) {
                            const calcPF = P / calcS;
                            if (calcPF > 1) {
                                alert('Calculated power factor exceeds 1.0. Please check your values.');
                                return;
                            }
                            setPowerFactor(calcPF.toFixed(4));
                            calculated.push('powerFactor');
                            
                            const sinTheta = Math.sqrt(1 - calcPF * calcPF);
                            const Q = calcS * sinTheta;
                            setReactivePower(Q.toFixed(4));
                        }
                        // If we have S given, calculate pf
                        else if (S !== null) {
                            // User provided both S and V,I - verify consistency or recalculate pf
                            const calcPF = S !== null && P !== null ? P / S : null;
                            if (calcPF !== null) {
                                setPowerFactor(calcPF.toFixed(4));
                                calculated.push('powerFactor');
                                const sinTheta = Math.sqrt(1 - calcPF * calcPF);
                                const Q = S * sinTheta;
                                setReactivePower(Q.toFixed(4));
                            }
                        }
                        setCalculatedField4(calculated);
                        return;
                    }

                    // Case 2: Only V given (calculate I from P, S, or pf)
                    if (V !== null && I === null) {
                        // Need S to calculate I: I = S √ó 1000 / (‚àö3 √ó V)
                        if (S !== null) {
                            const calcI = (S * 1000) / (Math.sqrt(3) * V);
                            setCurrent(calcI.toFixed(4));
                            const calculated = ['current'];

                            // If we have pf, calculate P
                            if (pf !== null) {
                                const calcP = S * pf;
                                setRealPower(calcP.toFixed(4));
                                calculated.push('realPower');
                                
                                const sinTheta = Math.sqrt(1 - pf * pf);
                                const Q = S * sinTheta;
                                setReactivePower(Q.toFixed(4));
                            }
                            // If we have P, calculate pf
                            else if (P !== null) {
                                const calcPF = P / S;
                                if (calcPF > 1) {
                                    alert('Calculated power factor exceeds 1.0. Please check your values.');
                                    return;
                                }
                                setPowerFactor(calcPF.toFixed(4));
                                calculated.push('powerFactor');
                                
                                const sinTheta = Math.sqrt(1 - calcPF * calcPF);
                                const Q = S * sinTheta;
                                setReactivePower(Q.toFixed(4));
                            }
                            setCalculatedField4(calculated);
                            return;
                        }
                        // Calculate S first from P and pf, then I
                        else if (P !== null && pf !== null) {
                            const calcS = P / pf;
                            setApparentPower(calcS.toFixed(4));
                            
                            const calcI = (calcS * 1000) / (Math.sqrt(3) * V);
                            setCurrent(calcI.toFixed(4));
                            
                            const sinTheta = Math.sqrt(1 - pf * pf);
                            const Q = calcS * sinTheta;
                            setReactivePower(Q.toFixed(4));
                            
                            setCalculatedField4(['apparentPower', 'current']);
                            return;
                        }
                    }

                    // Case 3: Only I given (calculate V from P, S, or pf)
                    if (I !== null && V === null) {
                        // Need S to calculate V: V = S √ó 1000 / (‚àö3 √ó I)
                        if (S !== null) {
                            const calcV = (S * 1000) / (Math.sqrt(3) * I);
                            setVoltage(calcV.toFixed(4));
                            const calculated = ['voltage'];

                            // If we have pf, calculate P
                            if (pf !== null) {
                                const calcP = S * pf;
                                setRealPower(calcP.toFixed(4));
                                calculated.push('realPower');
                                
                                const sinTheta = Math.sqrt(1 - pf * pf);
                                const Q = S * sinTheta;
                                setReactivePower(Q.toFixed(4));
                            }
                            // If we have P, calculate pf
                            else if (P !== null) {
                                const calcPF = P / S;
                                if (calcPF > 1) {
                                    alert('Calculated power factor exceeds 1.0. Please check your values.');
                                    return;
                                }
                                setPowerFactor(calcPF.toFixed(4));
                                calculated.push('powerFactor');
                                
                                const sinTheta = Math.sqrt(1 - calcPF * calcPF);
                                const Q = S * sinTheta;
                                setReactivePower(Q.toFixed(4));
                            }
                            setCalculatedField4(calculated);
                            return;
                        }
                        // Calculate S first from P and pf, then V
                        else if (P !== null && pf !== null) {
                            const calcS = P / pf;
                            setApparentPower(calcS.toFixed(4));
                            
                            const calcV = (calcS * 1000) / (Math.sqrt(3) * I);
                            setVoltage(calcV.toFixed(4));
                            
                            const sinTheta = Math.sqrt(1 - pf * pf);
                            const Q = calcS * sinTheta;
                            setReactivePower(Q.toFixed(4));
                            
                            setCalculatedField4(['apparentPower', 'voltage']);
                            return;
                        }
                    }

                    // Case 4: Standard power triangle calculation (no V or I)
                    const filled = [P, S, pf].filter(v => v !== null);
                    const empty = [P, S, pf].filter(v => v === null);

                    if (filled.length !== 2 || empty.length !== 1) {
                        alert('Please enter exactly 2 of the 3 main values (P, S, cos Œ∏), or provide V and/or I');
                        return;
                    }

                    if (P === null) {
                        // Calculate P from S and pf: P = S √ó cos(Œ∏)
                        const calcP = S * pf;
                        setRealPower(calcP.toFixed(4));
                        
                        const sinTheta = Math.sqrt(1 - pf * pf);
                        const Q = S * sinTheta;
                        setReactivePower(Q.toFixed(4));
                        
                        setCalculatedField4(['realPower']);
                    } 
                    else if (S === null) {
                        // Calculate S from P and pf: S = P / cos(Œ∏)
                        const calcS = P / pf;
                        setApparentPower(calcS.toFixed(4));
                        
                        const sinTheta = Math.sqrt(1 - pf * pf);
                        const Q = calcS * sinTheta;
                        setReactivePower(Q.toFixed(4));
                        
                        setCalculatedField4(['apparentPower']);
                    } 
                    else if (pf === null) {
                        // Calculate pf from P and S: cos(Œ∏) = P / S
                        if (P > S) {
                            alert('Real power cannot exceed apparent power');
                            return;
                        }
                        const calcPF = P / S;
                        setPowerFactor(calcPF.toFixed(4));
                        
                        const sinTheta = Math.sqrt(1 - calcPF * calcPF);
                        const Q = S * sinTheta;
                        setReactivePower(Q.toFixed(4));
                        
                        setCalculatedField4(['powerFactor']);
                    }
                } catch (error) {
                    alert(error.message || 'Calculation error - please check your values');
                }
            };

            const resetPage4 = () => {
                setRealPower('');
                setApparentPower('');
                setPowerFactor('');
                setVoltage('');
                setCurrent('');
                setCalculatedField4([]);
                setReactivePower(null);
            };

            const isOutOfRange = (value) => {
                if (!value || !average) return false;
                const val = parseFloat(value);
                return val > upperLimit || val < lowerLimit;
            };

            const getInputClass = (value) => {
                const baseClass = "w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent";
                if (isOutOfRange(value)) {
                    return `${baseClass} bg-red-100 border-red-500`;
                }
                return `${baseClass} border-gray-300`;
            };

            const getPage1InputClass = (fieldName) => {
                const baseClass = "w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent";
                if (calculatedField === fieldName) {
                    return `${baseClass} bg-green-100 border-green-500`;
                }
                return `${baseClass} border-gray-300`;
            };

            const getPage3InputClass = (fieldName) => {
                const baseClass = "w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent";
                
                if (fieldName === 'poles' && poles !== '') {
                    const p = parseFloat(poles);
                    if (!Number.isInteger(p) || p % 2 !== 0) {
                        return `${baseClass} bg-red-100 border-red-500`;
                    }
                }
                
                if (calculatedField3 === fieldName) {
                    return `${baseClass} bg-green-100 border-green-500`;
                }
                return `${baseClass} border-gray-300`;
            };

            const getPage4InputClass = (fieldName) => {
                const baseClass = "w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent";
                if (Array.isArray(calculatedField4) && calculatedField4.includes(fieldName)) {
                    return `${baseClass} bg-green-100 border-green-500`;
                }
                return `${baseClass} border-gray-300`;
            };

            const getPage4OptionalInputClass = (fieldName) => {
                const baseClass = "w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent";
                if (Array.isArray(calculatedField4) && calculatedField4.includes(fieldName)) {
                    return `${baseClass} bg-green-100 border-green-500`;
                }
                return `${baseClass} border-gray-300`;
            };

            return (
                <div 
                    className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 overflow-hidden"
                    onTouchStart={onTouchStart}
                    onTouchMove={onTouchMove}
                    onTouchEnd={onTouchEnd}
                >
                    <div className="max-w-md mx-auto relative pb-8">
                        {/* Page Indicator */}
                        <div className="flex justify-center gap-2 mb-4 pt-2">
                            <div className={`w-2 h-2 rounded-full transition-all ${currentPage === 0 ? 'bg-indigo-600 w-8' : 'bg-gray-300'}`}></div>
                            <div className={`w-2 h-2 rounded-full transition-all ${currentPage === 1 ? 'bg-indigo-600 w-8' : 'bg-gray-300'}`}></div>
                            <div className={`w-2 h-2 rounded-full transition-all ${currentPage === 2 ? 'bg-indigo-600 w-8' : 'bg-gray-300'}`}></div>
                            <div className={`w-2 h-2 rounded-full transition-all ${currentPage === 3 ? 'bg-indigo-600 w-8' : 'bg-gray-300'}`}></div>
                        </div>

                        <div className="relative" style={{ minHeight: 'auto' }}>
                            {/* Page 1: Temperature Calculator */}
                            <div 
                                className={`absolute w-full transition-all duration-300 ${
                                    currentPage === 0 ? 'translate-x-0 opacity-100 z-10' : '-translate-x-full opacity-0 pointer-events-none z-0'
                                }`}
                            >
                                <div className="bg-white rounded-2xl shadow-xl p-4 max-h-[calc(100vh-60px)] overflow-y-auto">
                                    <div className="flex items-center justify-center mb-4">
                                        <div className="w-8 h-8 text-indigo-600 mr-3"><Calculator /></div>
                                        <h1 className="text-lg font-bold text-gray-800">IEC60034 Temp/Resistance</h1>
                                    </div>
                                    
                                    <p className="text-xs text-gray-600 text-center mb-4">
                                        Enter any 3 values to calculate the 4th
                                    </p>

                                    <div className="mb-3">
                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                            Conductor Material
                                        </label>
                                        <select
                                            value={material}
                                            onChange={(e) => setMaterial(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                        >
                                            {Object.entries(materials).map(([key, val]) => (
                                                <option key={key} value={key}>
                                                    {val.name} (k = {val.k})
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="space-y-3 mb-4">
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Initial Temperature T‚ÇÅ (¬∞C)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={T1}
                                                onChange={(e) => setT1(e.target.value)}
                                                placeholder="e.g., 25"
                                                className={getPage1InputClass('T1')}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Final Temperature T‚ÇÇ (¬∞C)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={T2}
                                                onChange={(e) => setT2(e.target.value)}
                                                placeholder="e.g., 75"
                                                className={getPage1InputClass('T2')}
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-2 mb-3">
                                        <p className="text-xs text-blue-800">
                                            üí° <strong>Tip:</strong> Leave ONE field empty and fill the other three.
                                        </p>
                                    </div>

                                    <div className="flex gap-3 mb-3">
                                        <button
                                            onClick={calculateMissing}
                                            className="flex-1 bg-indigo-600 text-white py-2.5 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-md text-sm"
                                        >
                                            Calculate
                                        </button>
                                        <button
                                            onClick={reset}
                                            className="px-5 bg-gray-200 text-gray-700 py-2.5 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm"
                                        >
                                            Reset
                                        </button>
                                    </div>

                                   <div className="formula-card-content">
                                        <div className="formula-title">IEC60034 Temperature Correction of Resistance Formula</div>
                                    
                                        <div className="formula-display">
                                            <div className="fraction-container">
                                                <div className="fraction-numerator">R<span className="sub">2</span></div>
                                                <div className="fraction-denominator">R<span className="sub">1</span></div>
                                            </div>
                                            <span> = </span>
                                            <div className="fraction-container">
                                                <div className="fraction-numerator">k + T<span className="sub">2</span></div>
                                                <div className="fraction-denominator">k + T<span className="sub">1</span></div>
                                            </div>
                                        </div>
                                    
                                        <div className="formula-legend">
                                            <span className="legend-item"><strong>Where:</strong></span>
                                            <span className="legend-item">R<span className="sub">2</span> = Resistance at Temp T<span className="sub">2</span></span>
                                            <span className="legend-item">R<span className="sub">1</span> = Resistance at Temp T<span className="sub">1</span></span>
                                            <span className="legend-item">k = Reciprocal of temp. coefficient (235 for Copper)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Page 2: Resistance Average Calculator */}
                            <div 
                                className={`absolute w-full transition-all duration-300 ${
                                    currentPage === 1 ? 'translate-x-0 opacity-100 z-10' : currentPage === 0 ? 'translate-x-full opacity-0 pointer-events-none z-0' : '-translate-x-full opacity-0 pointer-events-none z-0'
                                }`}
                            >
                                <div className="bg-white rounded-2xl shadow-xl p-4 max-h-[calc(100vh-60px)] overflow-y-auto">
                                    <div className="flex items-center justify-center mb-4">
                                        <div className="w-8 h-8 text-indigo-600 mr-3"><TrendingUp /></div>
                                        <h1 className="text-lg font-bold text-gray-800">Resistance Analyser</h1>
                                    </div>
                                    
                                    <p className="text-xs text-gray-600 text-center mb-4">
                                        Calculate average and check ¬±1% tolerance
                                    </p>

                                    <div className="space-y-3 mb-4">
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Resistance 1 (Œ©)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={res1}
                                                onChange={(e) => setRes1(e.target.value)}
                                                placeholder="e.g., 100.5"
                                                className={getInputClass(res1)}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Resistance 2 (Œ©)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={res2}
                                                onChange={(e) => setRes2(e.target.value)}
                                                placeholder="e.g., 101.2"
                                                className={getInputClass(res2)}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Resistance 3 (Œ©)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={res3}
                                                onChange={(e) => setRes3(e.target.value)}
                                                placeholder="e.g., 99.8"
                                                className={getInputClass(res3)}
                                            />
                                        </div>
                                    </div>

                                    <div className="flex gap-3 mb-4">
                                        <button
                                            onClick={calculateAverage}
                                            className="flex-1 bg-indigo-600 text-white py-2.5 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-md text-sm"
                                        >
                                            Calculate
                                        </button>
                                        <button
                                            onClick={resetPage2}
                                            className="px-5 bg-gray-200 text-gray-700 py-2.5 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm"
                                        >
                                            Reset
                                        </button>
                                    </div>

                                    {average !== null && (
                                        <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border-2 border-green-200 mb-3">
                                            <h2 className="text-base font-bold text-gray-800 mb-2">Results</h2>
                                            
                                            <div className="space-y-2">
                                                <div className="flex justify-between items-center pb-2 border-b border-green-200">
                                                    <span className="text-xs text-gray-700 font-medium">Average:</span>
                                                    <span className="text-lg font-bold text-indigo-600">{average.toFixed(4)} Œ©</span>
                                                </div>
                                                
                                                <div className="flex justify-between items-center">
                                                    <span className="text-xs text-gray-700 font-medium">Upper Limit (+1%):</span>
                                                    <span className="text-sm font-semibold text-orange-600">{upperLimit.toFixed(4)} Œ©</span>
                                                </div>
                                                
                                                <div className="flex justify-between items-center">
                                                    <span className="text-xs text-gray-700 font-medium">Lower Limit (-1%):</span>
                                                    <span className="text-sm font-semibold text-orange-600">{lowerLimit.toFixed(4)} Œ©</span>
                                                </div>
                                            </div>

                                            {(isOutOfRange(res1) || isOutOfRange(res2) || isOutOfRange(res3)) && (
                                                <div className="mt-3 p-2 bg-red-100 border border-red-300 rounded-lg">
                                                    <p className="text-xs text-red-800 font-semibold">
                                                        ‚ö†Ô∏è Warning: One or more values are outside ¬±1% tolerance!
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    <div className="p-3 bg-gray-50 rounded-lg">
                                        <p className="text-xs text-gray-600">
                                            <strong>Note:</strong> Values outside the ¬±1% range will be highlighted in red.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            {/* Page 3: Machine Speed Calculator */}
                            <div 
                                className={`absolute w-full transition-all duration-300 ${
                                    currentPage === 2 ? 'translate-x-0 opacity-100 z-10' : currentPage < 2 ? 'translate-x-full opacity-0 pointer-events-none z-0' : '-translate-x-full opacity-0 pointer-events-none z-0'
                                }`}
                            >
                                <div className="bg-white rounded-2xl shadow-xl p-4 max-h-[calc(100vh-60px)] overflow-y-auto">
                                    <div className="flex items-center justify-center mb-4">
                                        <div className="w-8 h-8 text-indigo-600 mr-3"><Settings /></div>
                                        <h1 className="text-lg font-bold text-gray-800">Machine Speed Calculator</h1>
                                    </div>
                                    
                                    <p className="text-xs text-gray-600 text-center mb-4">
                                        Enter any 2 values to calculate the 3rd
                                    </p>

                                    <div className="space-y-3 mb-4">
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Speed n (RPM)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={speed}
                                                onChange={(e) => setSpeed(e.target.value)}
                                                placeholder="e.g., 1500"
                                                className={getPage3InputClass('speed')}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Frequency f (Hz)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={frequency}
                                                onChange={(e) => setFrequency(e.target.value)}
                                                placeholder="e.g., 50"
                                                className={getPage3InputClass('frequency')}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Number of Poles p
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={poles}
                                                onChange={(e) => setPoles(e.target.value)}
                                                placeholder="e.g., 4"
                                                className={getPage3InputClass('poles')}
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-2 mb-3">
                                        <p className="text-xs text-blue-800">
                                            üí° <strong>Tip:</strong> Leave ONE field empty and fill the other two.
                                        </p>
                                    </div>

                                    <div className="flex gap-3 mb-3">
                                        <button
                                            onClick={calculateSpeed}
                                            className="flex-1 bg-indigo-600 text-white py-2.5 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-md text-sm"
                                        >
                                            Calculate
                                        </button>
                                        <button
                                            onClick={resetPage3}
                                            className="px-5 bg-gray-200 text-gray-700 py-2.5 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm"
                                        >
                                            Reset
                                        </button>
                                    </div>

                                    {poles !== '' && (() => {
                                        const p = parseFloat(poles);
                                        return !Number.isInteger(p) || p % 2 !== 0;
                                    })() && (
                                        <div className="mb-3 p-3 bg-red-100 border border-red-300 rounded-lg">
                                            <p className="text-xs text-red-800 font-semibold">
                                                ‚ö†Ô∏è Poles must be a factor of two and an integer number
                                            </p>
                                        </div>
                                    )}

                                    {frequencyWarning && (
                                        <div className="mb-3 p-3 bg-red-100 border border-red-300 rounded-lg">
                                            <p className="text-xs text-red-800 font-semibold">
                                                ‚ö†Ô∏è {frequencyWarning}
                                            </p>
                                        </div>
                                    )}

                                    {speedWarning && (
                                        <div className="mb-3 p-3 bg-red-100 border border-red-300 rounded-lg">
                                            <p className="text-xs text-red-800 font-semibold">
                                                ‚ö†Ô∏è {speedWarning}
                                            </p>
                                        </div>
                                    )}

                                    <div className="formula-card-content">
                                        <div className="formula-title">Synchronous Speed Formula</div>
                                        
                                        <div className="formula-display">
                                            <span>n = </span>
                                            <div className="fraction-container">
                                                <div className="fraction-numerator">120 √ó f</div>
                                                <div className="fraction-denominator">p</div>
                                            </div>
                                        </div>
                                    
                                        <div className="formula-legend">
                                            <span className="legend-item"><strong>Where:</strong></span>
                                            <span className="legend-item">n = Synchronous speed (RPM)</span>
                                            <span className="legend-item">f = Frequency (Hz)</span>
                                            <span className="legend-item">p = Number of poles</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Page 4: Power Triangle Calculator */}
                            <div 
                                className={`absolute w-full transition-all duration-300 ${
                                    currentPage === 3 ? 'translate-x-0 opacity-100 z-10' : 'translate-x-full opacity-0 pointer-events-none z-0'
                                }`}
                            >
                                <div className="bg-white rounded-2xl shadow-xl p-4 max-h-[calc(100vh-60px)] overflow-y-auto">
                                    <div className="flex items-center justify-center mb-4">
                                        <div className="w-8 h-8 text-indigo-600 mr-3"><Zap /></div>
                                        <h1 className="text-lg font-bold text-gray-800">Power Triangle Calculator</h1>
                                    </div>
                                    
                                    <p className="text-xs text-gray-600 text-center mb-4">
                                        Enter any 2 of 3 main values to calculate
                                    </p>

                                    <div className="space-y-3 mb-4">
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Real Power P (kW)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={realPower}
                                                onChange={(e) => setRealPower(e.target.value)}
                                                placeholder="e.g., 75"
                                                className={getPage4InputClass('realPower')}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Apparent Power S (kVA)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={apparentPower}
                                                onChange={(e) => setApparentPower(e.target.value)}
                                                placeholder="e.g., 100"
                                                className={getPage4InputClass('apparentPower')}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                Power Factor (cos Œ∏)
                                            </label>
                                            <input
                                                type="number"
                                                step="any"
                                                value={powerFactor}
                                                onChange={(e) => setPowerFactor(e.target.value)}
                                                placeholder="e.g., 0.85"
                                                className={getPage4InputClass('powerFactor')}
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-gray-100 border border-gray-300 rounded-lg p-3 mb-4">
                                        <p className="text-xs font-semibold text-gray-700 mb-2">3-Phase Calculation (Optional)</p>
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-xs font-medium text-gray-600 mb-1">
                                                    Voltage V (V)
                                                </label>
                                                <input
                                                    type="number"
                                                    step="any"
                                                    value={voltage}
                                                    onChange={(e) => setVoltage(e.target.value)}
                                                    placeholder="e.g., 400"
                                                    className={getPage4OptionalInputClass('voltage')}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-medium text-gray-600 mb-1">
                                                    Current I (A)
                                                </label>
                                                <input
                                                    type="number"
                                                    step="any"
                                                    value={current}
                                                    onChange={(e) => setCurrent(e.target.value)}
                                                    placeholder="e.g., 150"
                                                    className={getPage4OptionalInputClass('current')}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-2 mb-3">
                                        <p className="text-xs text-blue-800">
                                            üí° <strong>Tip:</strong> Fill 2 of 3 main values, or use V & I for 3-phase calculation.
                                        </p>
                                    </div>

                                    <div className="flex gap-3 mb-3">
                                        <button
                                            onClick={calculatePower}
                                            className="flex-1 bg-indigo-600 text-white py-2.5 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-md text-sm"
                                        >
                                            Calculate
                                        </button>
                                        <button
                                            onClick={resetPage4}
                                            className="px-5 bg-gray-200 text-gray-700 py-2.5 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm"
                                        >
                                            Reset
                                        </button>
                                    </div>

                                    {reactivePower !== null && (
                                        <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 border-2 border-green-200 mb-3">
                                            <div className="flex justify-between items-center">
                                                <span className="text-xs text-gray-700 font-medium">Reactive Power Q:</span>
                                                <span className="text-base font-bold text-indigo-600">{reactivePower} kVAR</span>
                                            </div>
                                        </div>
                                    )}

                                    <div className="formula-card-content">
                                        <div className="formula-title">Power Triangle Formulas</div>
                                        
                                        <div className="formula-display" style={{marginBottom: '8px'}}>
                                            <span>P = S √ó cos(Œ∏)</span>
                                        </div>
                                        
                                        <div className="formula-display" style={{marginBottom: '8px'}}>
                                            <span>S = </span>
                                            <div className="fraction-container">
                                                <div className="fraction-numerator">P</div>
                                                <div className="fraction-denominator">cos(Œ∏)</div>
                                            </div>
                                        </div>
                                        
                                        <div className="formula-display" style={{marginBottom: '8px'}}>
                                            <span>cos(Œ∏) = </span>
                                            <div className="fraction-container">
                                                <div className="fraction-numerator">P</div>
                                                <div className="fraction-denominator">S</div>
                                            </div>
                                        </div>
                                        
                                        <div className="formula-display" style={{marginBottom: '8px'}}>
                                            <span>S<span className="sub">3œÜ</span> = ‚àö3 √ó V √ó I</span>
                                        </div>
                                        
                                        <div className="formula-display">
                                            <span>P<span className="sub">3œÜ</span> = ‚àö3 √ó V √ó I √ó cos(Œ∏)</span>
                                        </div>
                                    
                                        <div className="formula-legend">
                                            <span className="legend-item"><strong>Where:</strong></span>
                                            <span className="legend-item">P = Real Power (kW)</span>
                                            <span className="legend-item">S = Apparent Power (kVA)</span>
                                            <span className="legend-item">cos(Œ∏) = Power Factor</span>
                                            <span className="legend-item">V = Line Voltage (V)</span>
                                            <span className="legend-item">I = Line Current (A)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TempCalculator />, document.getElementById('root'));
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
